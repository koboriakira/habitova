# 習慣形成 AI アシスタントアプリ — プロジェクトサマリー

## 📋 プロジェクト概要

ユーザーの習慣形成を支援する AI アシスタントアプリ。単なるタスク管理を超えた「秘書型」の習慣ナビゲーションシステム。

**コア価値提案**：
- ユーザーの「理想の生活」をすべて一度に取り込む（Onboarding）
- 実際の行動との乖離を継続的に検出・調整する（実行モード）
- 習慣を段階的に最適化する（Onboarding / レポートモード）

---

## 🏗️ アーキテクチャ：3つのモード

```
┌─────────────────────────────────────────────┐
│                                             │
│  実行モード（日常利用）                     │
│  ├─ ユーザーの報告受付                      │
│  ├─ リアルタイム推測判定                    │
│  ├─ シンプルな AI 応答                      │
│  └─ バックグラウンド処理                    │
│                                             │
├─────────────────────────────────────────────┤
│                                             │
│  Onboarding モード（習慣の詳細化）          │
│  ├─ 質問リスト（キューイング）              │
│  ├─ ユーザー対話的に習慣を最適化            │
│  └─ Interview バージョン更新                │
│                                             │
├─────────────────────────────────────────────┤
│                                             │
│  レポートモード（進捗分析）                │
│  ├─ 統計分析・パターン抽出                  │
│  ├─ フィードバック生成                      │
│  └─ Onboarding 質問を自動生成               │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 📁 成果物

### 1. **habit_assistant_spec.md**
   - **内容**：アプリ全体の完全仕様書
   - **対象**：デザイン・アーキテクチャ・UX 全般
   - **セクション**：
     - 重要度・隠しパラメータの概念
     - 3 つのモード詳細
     - UI/UX 方針
     - デモシナリオ（Akira を例に）

### 2. **execution_mode_implementation_spec.md**
   - **内容**：実行モード実装の詳細仕様書
   - **対象**：バックエンド / フロントエンド開発者
   - **セクション**：
     - データモデル（SQL スキーマ）
     - モックデータ（Akira の習慣・チェーン）
     - コア機能実装（NLP・推測・応答生成）
     - API エンドポイント仕様
     - マイルストーン・注意点

---

## 🎯 実装計画

### **Phase 1：実行モード（第1フェーズ）**

**目標**：ユーザーが習慣を報告し、AI が推測判定する基本機能

**対象期間**：6 週間

**主要成果物**：
- [ ] DB スキーマ
- [ ] NLP エンジン（Claude API 統合）
- [ ] ExecutionInference エンジン
- [ ] メッセージ処理 API
- [ ] シンプルなチャット UI

**テストデータ**：
- モックユーザー：Akira（36歳、5歳の子ども）
- 定義済み習慣：12個
- 定義済みチェーン：8個

**成功指標**：
- メッセージ入力 → AI 応答のエンドツーエンド処理完了
- チェーン整合性チェック正常動作
- Onboarding キュー記録機能

---

### **Phase 2：Onboarding モード（第2フェーズ）**

**目標**：習慣の詳細化・最適化機能

**実装予定**：
- QueuedOnboardingQuestions 処理
- 詳細質問の動的生成
- Interview バージョン管理
- 習慣再定義・チェーン更新

---

### **Phase 3：レポートモード（第3フェーズ）**

**目標**：進捗分析・統計レポート

**実装予定**：
- HabitReport 生成
- パターン分析
- AI フィードバック
- Onboarding 質問の自動生成

---

## 💡 デモシナリオの反映

本仕様は、以下のデモ操作から導出されました：

### **Day 1：朝の実行**
- **9:30 起床** → 平日定義（7時）と矛盾を検出
- **朝食準備** → チェーン整合性で「洗顔」の欠落を確認
- **詳細情報提供** → 「居間の机をどかす」という隠れた習慣を発見

### **Onboarding 手動実行**
- 新規習慣「居間の机をどかす」について詳細質問
- 優先度・時間・チェーン関係を定義
- Interview v2 へ更新

**学習した設計原則**：
1. ✅ **実行モードはシンプルに** — 自動遷移しない、詳細情報は質問リスト
2. ✅ **重要度・隠しパラメータ** — Onboarding 対話から自動推測
3. ✅ **タスク vs 習慣** — 単発イベント（パッカーズ観戦）は習慣にしない
4. ✅ **並行実行** — 複数の習慣・タスクを同時記録できる
5. ✅ **前提条件チェーン** — 物理的な準備習慣をサポート

---

## 🔧 技術スタック（推奨）

### バックエンド
- **言語**：Python または Node.js
- **フレームワーク**：FastAPI または Express
- **DB**：PostgreSQL（JSON サポート）
- **AI**：Claude API

### フロントエンド
- **Web**：React / Vue
- **iOS**：SwiftUI（あなたの既存 Claude Code プロジェクト）
- **UI コンポーネント**：Tailwind CSS

### インフラ
- **デプロイ**：AWS / Google Cloud / Vercel
- **CI/CD**：GitHub Actions

---

## 📊 データフロー図

```
ユーザー入力
  ↓
[Message 保存]
  ↓
[NLP 解析] → 習慣/タスク抽出
  ↓
[ExecutionInference] → 推測判定
  ↓
┌─────────────────────────────────┐
│ HabitExecution または Task 保存  │
└─────────────────────────────────┘
  ↓
[チェーン整合性チェック]
  ↓
[AI 応答生成]
  ↓
┌─────────────────────────────────┐
│ Onboarding キュー更新            │
│ （バックグラウンド）             │
└─────────────────────────────────┘
  ↓
ユーザーへ応答
```

---

## 🎓 主要な設計概念

### 1. 重要度（Importance）と隠しパラメータ

```
Habit:
  ├─ importance: ユーザーが明示的に指定（未実装時は null）
  ├─ importanceInferred: Onboarding 対話から推測（0-1）
  └─ hiddenParameters: 複数の隠れた属性
      ├─ rigidityLevel: 習慣の柔軟性
      ├─ toleranceForFailure: 失敗許容度
      ├─ emotionalSignificance: 感情的重要度
      ├─ userRealisticExpectation: 現実的期待値
      └─ externalPressure: 外部からの圧力
```

### 2. チェーン整合性チェック

期待される習慣の順序 vs 実際の報告順序を比較し、スキップされた習慣を自動検出。

### 3. タスク vs 習慣

- **習慣**：繰り返す行動（朝食、ストレッチ）→ 習慣化候補
- **タスク**：単発イベント（パッカーズ観戦）→ レポートのみ含む

### 4. 前提条件チェーン（Prerequisite Chain）

```
朝食 → 机をどかす → ストレッチ
       （前提条件）
```

---

## 📝 使用シーン例

### **朝のルーティン（実行モード）**

```
User: 「9:30に起きました」
AI: 「おはようございます。朝7時起床とのことですね。...」
   [背景] 土曜日と平日の起床時刻の矛盾を検出
         → Onboarding キューに追加

User: 「コーヒーメーカーを動かし、子どもに朝食を出しました」
AI: 「素晴らしい。洗顔はしましたか？ またストレッチはしましたか？」
   [背景] チェーン整合性で「洗顔」のスキップを検出
         → プロアクティブに質問

User: 「洗顔はしました。朝食を食べてないので、まだストレッチはしていません」
AI: 「了解。朝食を食べた後、ストレッチをされるということですね。」
   [背景] ストレッチのタイミング情報をキャプチャ
         → Onboarding キューに詳細質問を追加
```

### **Onboarding（手動実行）**

```
User: Settings > 「習慣を見直す」をタップ

AI: 「本日の実行モードでの報告から、『居間の机をどかす』という
     新しい習慣が見えてきました。詳しくお聞きしたいことがあります。」

[質問1] 「毎回必要ですか？」
User: 「はい、毎回」

[質問2] 「どのくらい時間がかかりますか？」
User: 「1～2分」

[質問3] 「独立した習慣として扱いますか？」
User: 「独立した習慣として記録」

AI: 「了解。朝のルーティンが更新されました。」
    [背景] Interview v2 へ更新、新チェーン作成
```

---

## 🚀 次ステップ

### 直近（今週～来週）
- [ ] DB スキーマ設計・実装
- [ ] モックデータ準備（Akira の習慣）
- [ ] API フレームワーク構築

### 短期（2-3週）
- [ ] NLP エンジン実装
- [ ] ExecutionInference エンジン実装
- [ ] メッセージ処理フロー

### 中期（4-6週）
- [ ] テスト・デバッグ
- [ ] シンプル UI 実装
- [ ] Phase 1 完了

---

## 📞 開発リソース

### 必要なスキル
- **バックエンド**：Python / Node.js + DB 設計
- **NLP / AI**：Claude API 統合経験
- **フロントエンド**：React / Vue / SwiftUI

### 外部ツール
- Claude API（NLP・推測判定）
- PostgreSQL（DB）
- GitHub（バージョン管理）

---

## 💬 質問・要望

実装中に質問や仕様変更が発生した場合：

1. **実行モード** → 仕様書の「3.0.2」「3.0.3」参照
2. **UI/UX** → 仕様書の「5」参照
3. **API** → 実装仕様書の「4」参照

---

## 📌 重要な設計判断

| 項目 | 判断 | 理由 |
|------|------|------|
| **UI簡潔性** | 実行モードは短い質問のみ | ユーザーの思考を分断しない |
| **自動遷移** | 詳細情報も自動Onboarding遷移しない | ユーザーの混乱を避ける |
| **質問リスト** | キューイングで後処理 | タイミングを柔軟にする |
| **タスク記録** | 習慣ではなく Task として | 習慣化候補と区別 |
| **並行実行** | 複数習慣の同時記録 | 現実的な行動パターンに対応 |
| **モックデータ** | Akiraのみで開発開始 | 実装をシンプルに保つ |

---

**このプロジェクトの目指すところ**：

*ユーザーの理想と現実のギャップを継続的に埋め、習慣形成を自然に支援する AI アシスタント*

---

**作成日**：2025-01-01  
**最終更新**：2025-01-01

